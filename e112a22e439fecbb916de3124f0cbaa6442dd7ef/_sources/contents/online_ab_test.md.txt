# Online A/B í…ŒìŠ¤íŠ¸
### ìƒ˜í”Œ í¬ê¸° ì¶”ì •
Battleground ì˜ ìƒ˜í”Œ í¬ê¸° ì¶”ì •ì€ ë¹ˆë„ í†µê³„í•™ì„ ë”°ë¼ ì •ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ì „ ê°€ì •(ë¶„ì‚° ë™ì¼ ìœ ë¬´)ì˜ ì°¨ì´ì— ë”°ë¼ í¬ê²Œ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ êµ¬ì„±ì´ ë˜ì—ˆìœ¼ë©° ë‘˜ ëª¨ë‘ êµ¬í˜„ë˜ì–´ ìˆì–´ì„œ ì‚¬ìš©ìê°€ ì„ íƒí•´ì„œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ ë“¤ì˜ ìˆ˜í–‰ì€ ì•„ë˜ì˜ ìˆ˜ì‹ì„ ë”°ë¼ ìˆ˜í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ìˆ˜ì‹ì€ ìŠ¤íƒ í¬íŠ¸ì˜ ê°•ì˜ì—ì„œ ë°œì·Œ[1]í•œ ìƒ˜í”Œ í¬ê¸° ì¶”ì • ìˆ˜ì‹ì…ë‹ˆë‹¤. 

![stanford](./images/stanford.png)

ë‘ ë²ˆì§¸ ìˆ˜ì‹ì€ Evan Miler ì˜ Post[2, 3]ì—ì„œ ë°œì·Œí•œ ìƒ˜í”Œ í¬ê¸° ì¶”ì • ìˆ˜ì‹ì…ë‹ˆë‹¤. 

![evan](./images/evan.png)

ì´ ë°©ë²•ë“¤ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ì „ì— ì•Œì•„ì•¼í•˜ëŠ” ëª‡ëª‡ ê°’ë“¤ì´ ìˆìŠµë‹ˆë‹¤. 
- p : ê¸°ì¡´ ì•Œê³ ë¦¬ì¦˜ì˜ ì „í™˜ìœ¨ì…ë‹ˆë‹¤. ì „í™˜ìœ¨ì˜ ì •ì˜ëŠ” í´ë¦­ í˜¹ì€ ê°€ì… ë“± ë‹¤ì–‘í•˜ê²Œ ì •ì˜ë  ìˆ˜ ìˆìœ¼ë©° ì˜ˆì‹œì—ì„œëŠ” í´ë¦­ìœ¼ë¡œ ì§„í–‰ë  ì˜ˆì •ì…ë‹ˆë‹¤. 
- alpha : 1ì¢… ì˜¤ë¥˜ì˜ í¬ê¸°ì…ë‹ˆë‹¤. 1ì¢… ì˜¤ë¥˜ëŠ” ê°„ë‹¨í•˜ê²Œ ë§í•˜ë©´ ë§ëŠ”ë° í‹€ë¦¬ë‹¤ê³  í•˜ëŠ” ê²½ìš°ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. 
- power : 2ì¢… ì˜¤ë¥˜ë„ ì•Œì•„ì•¼í•©ë‹ˆë‹¤. 2ì¢…ì˜¤ë¥˜ëŠ” í‹€ë¦°ë° ë§ë‹¤ê³  í•  ê²½ìš°ì…ë‹ˆë‹¤. 
- expected : ìƒˆë¡œìš´ ì•Œê³ ë¦¬ì¦˜ì˜ ê¸°ëŒ€ë˜ëŠ” ì „í™˜ìœ¨ì…ë‹ˆë‹¤. ì˜ˆì‹œì—ì„œëŠ” Offline A/B í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì˜€ìŠµë‹ˆë‹¤. 
- bucket_min_size : ê¸°ì¡´ ì•Œê³ ë¦¬ì¦˜ì˜ ë²„í‚·ë‹¹ 1ì¼ ìµœì†Œ ìœ ì… ìœ ì € ìˆ˜ ì…ë‹ˆë‹¤. ì´ëŠ” ìµœì†Œ ëª‡ì¼ ê°„ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ì§€ ëª¨ë‹ˆí„°ë§ ê¸°ê°„ì„ ê³„ì‚°í•˜ê¸° ìœ„í•¨ì´ë©° ê³„ì‚°ëœ ìƒ˜í”Œí¬ê¸°ë¡œë¶€í„° ìµœì†Œ ìœ ì €ìˆ˜ë¥¼ ë‚˜ëˆ„ì–´ ê³„ì‚°í•˜ë©° 1ì£¼ì¼ë³´ë‹¤ ì‘ì€ ê²½ìš° 1ì£¼ì¼ì„ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤. 
- mde_method : MDE ë°©ë²•ì…ë‹ˆë‹¤. MDE ê°’ì€ Minimum detectable effect, ìµœì†Œí•œì˜ ê²€ì¶œ ê°€ëŠ¥ íš¨ê³¼ë¥¼ ì˜ë¯¸í•˜ë©° ë‘ ì•Œê³ ë¦¬ì¦˜ì˜ ì „í™˜ìœ¨ì˜ ì°¨ì´ë¥¼ ì–´ëŠ ì •ë„ë¡œ ë³¼ ì§€ ê²°ì •í•˜ëŠ” ê°’ì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ë‘ ì•Œê³ ë¦¬ì¦˜ ê°ê°ì˜ ì „í™˜ìœ¨ì˜ ì°¨ì´, ë°°ìˆ˜, Cohen's hê°€ êµ¬í˜„ë˜ì–´ìˆìœ¼ë©° ê¸°ë³¸ê°’ì€ Cohen's hë¥¼ ë”°ë¼ ê³„ì‚°í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ê·¸ ì™¸ì—ë„ ì‚¬ìš©ìê°€ ì§ì ‘ ì¶”ì •í•œ ë‘ ì•Œê³ ë¦¬ì¦˜ ê°„ì˜ ì „í™˜ìœ¨ì˜ ì°¨ì´ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì—¬ ê³„ì‚°í•  ìˆ˜ ìˆì„ ìˆ˜ ìˆë„ë¡ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. 
- case : ë™ì¼ ë¶„ì‚°ì˜ ê°€ì • ìœ ë¬´ì…ë‹ˆë‹¤. ê° ì‚¬ì „ì— ì •ì˜ëœ ê°’ì„ ë”°ë¼ ê³„ì‚°ë˜ì–´ ê° ë²„í‚· ë‹¹ ìµœì†Œ ìƒ˜í”Œ ìˆ˜ë¥¼ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤. ê¸°ë³¸ ê°’ì€ ë™ì¼ ë¶„ì‚°ì´ ì•„ë‹ˆë¼ëŠ” ê°€ì •í•˜ì— ê³„ì‚°ë©ë‹ˆë‹¤.

```
>>> #Online A/B test ì‚¬ìš© ì˜ˆì‹œ
>>> base_ctr = (bucket_a['reward'] == 1).sum() / bucket_a.shape[0]
>>> print("ê¸°ì¡´ CTR : ", base_ctr)
>>> print("Offline A/B test ê²°ê³¼ ê¸°ëŒ€ CTR : ", cis_weight['CIS_weight'].mean())
ê¸°ì¡´ CTR :  0.01483019427554501
Offline A/B test ê²°ê³¼ ê¸°ëŒ€ CTR :  0.06893937460876202

>>> sample_size_estimater = SampleSizeEstimater(alpha = 0.05
>>>                                             , power = 0.9
>>>                                             , p = base_ctr
>>>                                             , expected = cis_weight['CIS_weight'].mean())
>>> sample_size, require_periods = sample_size_estimater.cal_sample_size()
>>> print("ë¹„êµí•˜ê³ ì í•˜ëŠ” ëª¨ë¸ì˜ CTR ì´ 5% ì„ì„ ê²€ì¦í•˜ë ¤ê³  í• ë•Œ í•„ìš”í•œ ì‹¤í—˜(ë²„í‚·) ë‹¹ ìµœì†Œ ìƒ˜í”Œ ìˆ˜ : ", sample_size)
ë¹„êµí•˜ê³ ì í•˜ëŠ” ëª¨ë¸ì˜ CTR ì´ 5% ì„ì„ ê²€ì¦í•˜ë ¤ê³  í• ë•Œ í•„ìš”í•œ ì‹¤í—˜(ë²„í‚·) ë‹¹ ìµœì†Œ ìƒ˜í”Œ ìˆ˜ :  15954

>>> sample_size_estimater.get_distribution() #alpha ì™€ power ë³„ ìƒ˜í”Œ í¬ê¸° plot
```
![dist](./images/dist.png)

### ì „í™˜ ì„±ëŠ¥ ë¹„êµ
battleground ì˜ ì—¬ëŸ¬ê°€ì§€ ì„±ëŠ¥ ì¸¡ì • ë°©ë²•ë“¤ì€ ì‚¬ìš©ì˜ í¸ë¦¬í•¨ì„ ìœ„í•˜ì—¬ ë™ì¼í•œ í˜•íƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ Pandas DataFrame ì„ ë°›ëŠ” í˜•ì‹ì´ë©° íŒŒë¼ë¯¸í„°ëŠ” ì»¬ëŸ¼ëª…ì„ ë°›ëŠ” ë“± sklearn ì—ì„œ ìˆ˜í–‰í•˜ë“¯ì´ ì–´ëŠì •ë„ ì •í•´ì§„ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ë°›ì•„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ìˆ˜í–‰ ë˜ì—ˆìŠµë‹ˆë‹¤. ì„±ëŠ¥ì„ ë” ë¹ ë¥´ê²Œ í•˜ê¸° ìœ„í•˜ì—¬ list ë‚˜ array ë¥¼ ë°›ì•„ numpyë¡œ ì—°ì‚°í•  ìˆ˜ ìˆì§€ë§Œ ì‚¬ìš©ìë¡œ í•˜ì—¬ê¸ˆ ìµìˆ™í•´ì§€ë©´ ì†ì‰½ê²Œ ì“¸ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì— ì´ˆì ì„ ë§ì¶”ì–´ ì–´ëŠì •ë„ì˜ ììœ ë„ë¥¼ ì œí•œí•˜ê³  ê¸°ì¤€ì„ í†µì¼í•˜ì—¬ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. ë§Œì•½ ì¶”í›„ ì„±ëŠ¥ ì´ìŠˆê°€ ë°œìƒ ì‹œ ì„±ëŠ¥ì„ ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ trickly í•œ ë°©ë²•ë“¤ì„ ì‚¬ìš©í•˜ì—¬ ì¶”ê°€ë¡œ ê°œë°œì„ ì§€ì›í•  ì˜ˆì •ì´ë‹ˆ í•„ìš”í•˜ì‹œë©´ ë‹´ë‹¹ìì—ê²Œ ì—°ë½ì£¼ì‹œë©´ ê°ì‚¬í•©ë‹ˆë‹¤. ë˜í•œ A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ì¶”ì •í•˜ëŠ” ê²ƒì„ ë¨¼ì € ê°œë°œí•´ë‘ì—ˆìŠµë‹ˆë‹¤. A/B/C ë‚˜ A/B/C/D ë“±ì€ ì—¬ê±´ì´ ë˜ëŠ”ëŒ€ë¡œ ì ì§„ì ìœ¼ë¡œ ê³ ë„í™”ë¥¼ í•´ê°€ë©° ì¶”ê°€í•  ì˜ˆì •ì´ë‹ˆ ì°¸ì¡°í•˜ì—¬ ì£¼ì‹œë©´ ê°ì‚¬í•©ë‹ˆë‹¤.

#### ë¹ˆë„ í†µê³„ ê¸°ë°˜
##### ì¹´ì´ì œê³± ê²€ì¦
battleground ì˜ ì „í™˜ìœ¨ ë¹„êµ ì„±ëŠ¥ì€ í¬ê²Œ ë¹ˆë„í†µê³„ ê¸°ë°˜ ë°©ì‹ê³¼ ë² ì´ì§€ì•ˆ ë°©ì‹ 2ê°€ì§€ë¥¼ ì¤€ë¹„í•´ë‘ì—ˆìŠµë‹ˆë‹¤. ë¹ˆë„ í†µê³„ ë°©ì‹ì€ ì¹´ì´ì œê³± ê²€ì¦ê³¼ ë¹„ìœ¨ ê²€ì¦ì´ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©° ì¹´ì´ì œê³±ì€ ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ ìœ ë¬´(í´ë¦­/ê°€ì… ë“±)ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ë„£ì—ˆìŠµë‹ˆë‹¤. ì¹´ì´ì œê³± ê²€ì¦ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [4]ì„ ì°¸ì¡°í•˜ì‹œë©´ ìì„¸íˆ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. H0 ëŠ” ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ ìœ ë¬´ëŠ” ì—°ê´€ì„±ì´ ì—†ë‹¤ ì´ë©° H1ì€ ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ ìœ ë¬´ê°€ ì—°ê´€ì„±ì´ ìˆë‹¤ ì…ë‹ˆë‹¤. ì¦‰, ì¶”ì²œ ìœ ë¬´ê°€ ì „í™˜ê³¼ì˜ ì—°ê´€ì„±ì´ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒ˜í”Œ í¬ê¸° ì¶”ì •ì„ í†µí•´ ì–´ëŠì •ë„ ìˆ˜ ì´ìƒì˜ ìƒ˜í”Œì„ í…ŒìŠ¤íŠ¸ í•  ê²ƒì´ë¼ê³  ê°€ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— í”¼ì…”ì˜ ì •í™•ë„ ê²€ì¦ì€ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.

```
>>> #Chi sqare test ì‚¬ìš© ì˜ˆì‹œ
>>> chi_squ = ConversionEstimater(control = bucket_a[['ci', 'prod_id', 'reward']]
>>>                               , target = random_bucket[['ci', 'prod_id', 'reward']]
>>>                               , control_reward_col = 'reward'
>>>                               , target_reward_col = 'reward'
>>>                               , control_reward_val = 1
>>>                               , target_reward_val = 1)
>>> chi2, p_val, df, expected, effect_size = chi_squ.chi_square_val()
>>> if p_val < 0.05 :
>>>     print("ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ì´ ì—°ê´€ì„±ì´ ìˆë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆë‹¤. ì¦‰, ì¶”ì²œ ìœ ë¬´ê°€ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì—ˆë‹¤.")
>>> else:
>>>     print("ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ì´ ì—°ê´€ì„±ì´ ìˆë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ì—†ë‹¤. ì¦‰, ì¶”ì²œ ìœ ë¬´ê°€ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì§€ ëª»í•˜ì˜€ë‹¤.")
ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ì´ ì—°ê´€ì„±ì´ ìˆë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆë‹¤. ì¦‰, ì¶”ì²œ ìœ ë¬´ê°€ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì—ˆë‹¤. #ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì´ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.
```

ë°˜í™˜ë˜ëŠ” ê²°ê³¼ëŠ” ì¹´ì´ì œê³± í†µê³„ëŸ‰ê³¼ p value, ììœ ë„, ê¸°ëŒ€ê°’, íš¨ê³¼í¬ê¸°ì…ë‹ˆë‹¤. ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜í–¥ì„ ì¤€ë‹¤ê³  ë³¼ ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆìœ¼ë©° íš¨ê³¼í¬ê¸°ë¥¼ í†µí•´ ì–¼ë§Œí¼ ì˜í–¥ì„ ì¤€ë‹¤ê³  ë³¼ ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¹´ì´ì œê³± ì‹¤í–‰ ì‹œ ììœ ë„ê°€ 5ì´í•˜ì¸ ê²½ìš°ì— ëŒ€í•´ì„œ íš¨ê³¼ í¬ê¸°ê°€ ì–´ëŠ ì •ë„ ì°¨ì´ê°€ ë‚˜ëŠ”ì§€ë¥¼ ì¼ë°˜ì ìœ¼ë¡œ í•´ì„í•˜ëŠ” DataFrameì„ ì¶œë ¥í•´ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ëŒ€ì¡°êµ° x ì²˜ì§€êµ°ì˜ í´ë¦­/ë¯¸í´ë¦­ì˜ ê²½ìš° ììœ ë„ê°€ 1ì´ë¯€ë¡œ ììœ ë„ê°€ 1ì¼ ê²½ìš° ì¼ë°˜ì ìœ¼ë¡œ íš¨ê³¼í¬ê¸°ë¥¼ í•´ì„í•˜ëŠ” ê¸°ì¤€ì„ ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥í•´ì¤ë‹ˆë‹¤. 

![degree](./images/degree.png)

í•˜ì§€ë§Œ ì´ í¬ê¸°ê°€ ì ˆëŒ€ì ì¸ ê²ƒì€ ì•„ë‹ˆë©° ìƒí™©ê³¼ ë°ì´í„°ì— ë”°ë¼ p-valueì™€ ê°™ì´ ì—°êµ¬ìê°€ í•´ì„í•˜ê¸° ë‚˜ë¦„ì´ë¼ëŠ” ì ì„ ìœ ì˜í•´ì•¼í•©ë‹ˆë‹¤.

##### ë¹„ìœ¨ ê²€ì¦
battleground ì— êµ¬í˜„ëœ ë¹ˆë„ í†µê³„ ê¸°ë°˜ ë¹„ìœ¨ ê²€ì¦ì€ z ê°’ì„ í†µí•´ ê³„ì‚°í•˜ë©° ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ ë³„ ì „í™˜ ìœ ë¬´(í´ë¦­/ê°€ì… ë“±)ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ìœ¨ ê²€ì¦ì€ [6]ë¥¼ ì°¸ì¡°í•˜ì‹œë©´ ìì„¸í•œ ë‚´ìš©ì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. H0ëŠ” ë‘ ì§‘ë‹¨ê°„ ë¹„ìœ¨ì— ì°¨ì´ê°€ ì—†ë‹¤ì´ë©° H1ì€ ì°¨ì´ê°€ ìˆë‹¤ ì…ë‹ˆë‹¤. ì¦‰, ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ ë³„ ì „í™˜ ë¹„ìœ¨ì— ì°¨ì´ê°€ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ìƒ˜í”Œ í¬ê¸° ì¶”ì •ì„ í†µí•´ ì–´ëŠì •ë„ ìˆ˜ ì´ìƒì˜ ìƒ˜í”Œì„ í…ŒìŠ¤íŠ¸ í•  ê²ƒì´ë¼ê³  ê°€ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— ë¶„ì‚° ì •ê·œì„± ê²€ì¦ ë“±ì€ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.

```     
>>> #z test ì‚¬ìš© ì˜ˆì‹œ
>>> z_test = ConversionEstimater(control = bucket_a[['ci', 'prod_id', 'reward']]
>>>                              , target = random_bucket[['ci', 'prod_id', 'reward']]
>>>                              , control_reward_col = 'reward'
>>>                              , target_reward_col = 'reward'
>>>                              , control_reward_val = 1
>>>                              , target_reward_val = 1)
>>> control_prop, treatment_prop, z_stat, p_value, control_confidence_interval_control, treatment_confidence_interval_control, effect_size = z_test.prop_test()            
>>> if p_val < 0.05 :
>>>     print("ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ ë¹„ìœ¨ì´ ê°™ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆë‹¤. ì¦‰, ì¶”ì²œ ìœ ë¬´ê°€ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì—ˆë‹¤.")
>>> else:
>>>     print("ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ ë¹„ìœ¨ì´ ê°™ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ì—†ë‹¤. ì¦‰, ì¶”ì²œ ìœ ë¬´ê°€ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì§€ ëª»í•˜ì˜€ë‹¤.")
ì¶”ì²œ ìœ ë¬´ ë³„ ì „í™˜ ë¹„ìœ¨ì´ ê°™ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆë‹¤. ì¦‰, ì¶”ì²œ ìœ ë¬´ê°€ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  ì£¼ì¥í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì—ˆë‹¤. #ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì´ ì „í™˜ì— ì˜í–¥ì„ ì¤€ë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.
```

ë°˜í™˜ë˜ëŠ” ê²°ê³¼ëŠ” ëŒ€ì¡°êµ° ì „í™˜ë¹„ìœ¨, íƒ€ê²Ÿêµ° ì „í™˜ë¹„ìœ¨, z í†µê³„ëŸ‰ê³¼ p value, ëŒ€ì¡°êµ° ì‹ ë¢°êµ¬ê°„, íƒ€ê²Ÿêµ° ì‹ ë¢°êµ¬ê°„, íš¨ê³¼í¬ê¸°ì…ë‹ˆë‹¤. ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜í–¥ì„ ì¤€ë‹¤ê³  ë³¼ ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆìœ¼ë©° íš¨ê³¼í¬ê¸°ë¥¼ í†µí•´ ì–¼ë§Œí¼ ì˜í–¥ì„ ì¤€ë‹¤ê³  ë³¼ ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¹´ì´ì œê³±ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì´ í¬ê¸°ê°€ ì ˆëŒ€ì ì¸ ê²ƒì€ ì•„ë‹ˆë©° ìƒí™©ê³¼ ë°ì´í„°ì— ë”°ë¼ p-valueì™€ ê°™ì´ ì—°êµ¬ìê°€ í•´ì„í•˜ê¸° ë‚˜ë¦„ì´ë¼ëŠ” ì ì„ ìœ ì˜í•´ì•¼í•©ë‹ˆë‹¤.

#### ë² ì´ì§€ì•ˆ ê¸°ë°˜
##### ë² ì´ì§€ì•ˆ A/B í…ŒìŠ¤íŠ¸
ë² ì´ì§€ì•ˆ ê²€ì¦ì€ A/B, A/B/C, A/B/C/D í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë„ë¡ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Battleground ì— êµ¬í˜„ë˜ì–´ìˆëŠ” ë² ì´ì§€ì•ˆ ê²€ì¦ì€ ë³´ìƒì´ Binary ì¸ ê²½ìš°ì— í•œí•´ ê°œë°œë˜ì—ˆìœ¼ë‹ˆ ì‚¬ìš©ì— ìœ ì˜ë¥¼ í•´ì•¼í•©ë‹ˆë‹¤. ë² ì´ì§€ì•ˆ A/B ê³„ì‚°ì€ ì•„ë˜ì˜ ìˆ˜ì‹ì„ ë”°ë¼ ì§„í–‰ ë©ë‹ˆë‹¤. ì•„ë˜ì˜ ìˆ˜ì‹ì€ ìœ ì‚¬í•œ ê²°ê³¼ë¥¼ ì‚°ì¶œí•˜ê²Œ ë˜ë©° ìì„¸í•œ ì¦ëª…ì€ [5]ì„ ì°¸ì¡°í•˜ì‹œë©´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ab](./images/ab.png)
![ab2](./images/ab2.png)

- ğ›¼ğ´ : A ì•Œê³ ë¦¬ì¦˜ì˜ ì „í™˜(í´ë¦­ í˜¹ì€ ê°€ì… ë“±) ì„±ê³µ ìˆ˜
- ğ›½ğ´ : A ì•Œê³ ë¦¬ì¦˜ì˜ ì „í™˜(í´ë¦­ í˜¹ì€ ê°€ì… ë“±) ì‹¤íŒ¨ ìˆ˜
- ğ›¼ğµ : B ì•Œê³ ë¦¬ì¦˜ì˜ ì „í™˜(í´ë¦­ í˜¹ì€ ê°€ì… ë“±) ì„±ê³µ ìˆ˜
- ğ›½ğµ : B ì•Œê³ ë¦¬ì¦˜ì˜ ì „í™˜(í´ë¦­ í˜¹ì€ ê°€ì… ë“±) ì‹¤íŒ¨ ìˆ˜
- ğµ : ë² íƒ€ í•¨ìˆ˜

```     
>>> # ë² ì´ì§€ì•ˆ A/B í…ŒìŠ¤íŠ¸ ì‚¬ìš© ì˜ˆì‹œ
>>> online_abtesting = ConversionEstimater(control = bucket_a
>>>                                        , target = bucket_b_example
>>>                                        , control_reward_col = 'reward'
>>>                                        , target_reward_col = 'reward')
>>> control_click_rate, target_click_rate, prob_b_a = online_abtesting.cal_bayes_prob()
>>> print("Control Grp Click rate : ", control_click_rate)
>>> print("Target Grp Click rate : ", target_click_rate)
>>> print("probability Pt > Pc : ", prob_b_a)
>>> print("ì§€ìˆ˜í˜• -> ìˆ«ìí˜• : ", '{:.8f}'.format(prob_b_a))
Control Grp Click rate :  0.01483019427554501
Target Grp Click rate :  0.0015598692680994354
probability Pt > Pc :  3.7421643192430597e-113
ì§€ìˆ˜í˜• -> ìˆ«ìí˜• :  0.00000000
```  
   
ë°˜í™˜ë˜ëŠ” ê²°ê³¼ëŠ” ëŒ€ì¡°êµ° ì „í™˜ìœ¨, íƒ€ê²Ÿêµ° ì „í™˜ìœ¨, íƒ€ê²Ÿêµ°ì´ ëŒ€ì¡°êµ° ëŒ€ë¹„ ë” ë§ì´ ì „í™˜ë  í™•ë¥ ì…ë‹ˆë‹¤. ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜í–¥ì„ ì¤€ë‹¤ê³  ë³¼ ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. "ì§‘ë‹¨ ë³„ íš¨ê³¼ê°€ ì—†ë‹¤ë©´ ë¬´ì‘ìœ„ í‘œë³¸ ì¶”ì¶œ ì˜¤ë¥˜ë¡œ ì¸í•´ ì—°êµ¬ì˜ n%ì—ì„œ ê´€ì°°ëœ ìˆ˜ì¤€ ì´ìƒì˜ ì°¨ì´ê°€ ë„ì¶œëœë‹¤" ë¼ê³  í•´ì„í•´ì•¼í•˜ëŠ” ë¹ˆë„ í†µê³„ ê¸°ë°˜ ë°©ë²•ë“¤ê³¼ ë‹¤ë¥´ê²Œ ë² ì´ì§€ì•ˆ ë°©ë²•ì€ ë³´ë‹¤ ì§ê´€ì ìœ¼ë¡œ "íƒ€ê²Ÿêµ°ì´ ëŒ€ì¡°êµ° ëŒ€ë¹„ ë” ë§ì´ ì „í™˜ë  í™•ë¥ ì´ nì´ë‹¤"ë¼ê³  í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹ˆë„ í†µê³„ ê¸°ë°˜ì˜ ë°©ë²•ë“¤ì€ ëª¨ì§‘ë‹¨ì— ëŒ€í•´ ê·€ë¬´ ê°€ì„¤ì´ ì°¸ì´ë©° í‘œë³¸ì˜ ì°¨ì´ê°€ ì˜¤ë¡œì§€ ë¬´ì‘ìœ„ í™•ë¥ ì— ì˜í•´ ë°œìƒí–ˆë‹¤ëŠ” ê°€ì •ì— ê¸°ë°˜í•˜ì—¬ ê³„ì‚°ë˜ê¸° ë•Œë¬¸ì— ê·€ë¬´ ê°€ì„¤ì˜ ì°¸, ê±°ì§“ í™•ë¥ ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ì—†ëŠ”ë° ë°˜í•´ ë² ì´ì§€ì•ˆ ë°©ë²•ì€ ì§ê´€ì ìœ¼ë¡œ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                                
##### ë² ì´ì§€ì•ˆ A/B/C í…ŒìŠ¤íŠ¸
ë² ì´ì§€ì•ˆ A/B/C ê²€ì¦ì€ ì•„ë˜ì˜ ìˆ˜ì‹ì„ ë”°ë¼ ì§„í–‰ ë©ë‹ˆë‹¤. ìì„¸í•œ ì¦ëª…ì€ [8]ì„ ì°¸ì¡°í•˜ì‹œë©´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![abc](./images/abc.png)

ğ›¼ğ‘‹ : A, B, C ì•Œê³ ë¦¬ì¦˜ ê°ê°ì˜ ì „í™˜(í´ë¦­ í˜¹ì€ ê°€ì… ë“±) ì„±ê³µ ìˆ˜, ğ‘‹âˆˆ{ğ´,ğµ,ğ¶}.
ğ›½ğ‘‹ : A, B, C ì•Œê³ ë¦¬ì¦˜ ê°ê°ì˜ ì „í™˜(í´ë¦­ í˜¹ì€ ê°€ì… ë“±) ì‹¤íŒ¨ ìˆ˜, ğ‘‹âˆˆ{ğ´,ğµ,ğ¶}.
Pr(ğ‘ğ‘‹>ğ‘ğ¶) : ë² ì´ì§€ì•ˆ A/C, B/C ê²€ì¦ ê²°ê³¼, ğ‘‹âˆˆ{ğ´,ğµ,ğ¶}.

```     
>>> # ë² ì´ì§€ì•ˆ A/B/C í…ŒìŠ¤íŠ¸ ì‚¬ìš© ì˜ˆì‹œ
>>> online_abtesting = ConversionEstimater(control = bucket_a
>>>                                        , target = bucket_b_example
>>>                                        , control_reward_col = 'reward'
>>>                                        , target_reward_col = 'reward'
>>>                                        , control2 = bucket_c)
>>> control_click_rate, control2_click_rate, target_click_rate, prob_b_a = online_abtesting.cal_multi_bayes_prob()
>>> print("Control 1 Grp Click rate : ", control_click_rate)
>>> print("Control 2 Grp Click rate : ", control2_click_rate)
>>> print("Target Grp Click rate : ", target_click_rate)
>>> print("probability Pt > Pc : ", prob_t_c)
>>> print("ì§€ìˆ˜í˜• -> ìˆ«ìí˜• : ", '{:.8f}'.format(prob_t_c))
Control 1 Grp Click rate :  0.01483019427554501
Control 2 Grp Click rate :  0.02323984298374124
Target Grp Click rate :  0.0015598692680994354
probability Pt > Pc :  3.7421643192430597e-113
ì§€ìˆ˜í˜• -> ìˆ«ìí˜• :  0.00000000
```  
   
ë°˜í™˜ë˜ëŠ” ê²°ê³¼ëŠ” ëŒ€ì¡°êµ° 1 ì „í™˜ìœ¨, ëŒ€ì¡°êµ° 2 ì „í™˜ìœ¨, íƒ€ê²Ÿêµ° ì „í™˜ìœ¨, íƒ€ê²Ÿêµ°ì´ ëŒ€ì¡°êµ° ëŒ€ë¹„ ë” ë§ì´ ì „í™˜ë  í™•ë¥ ì…ë‹ˆë‹¤. ë² ì´ì§€ì•ˆ A/B í…ŒìŠ¤íŠ¸ì™€ ë™ì¼í•˜ê²Œ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 
##### ë² ì´ì§€ì•ˆ A/B/C/D í…ŒìŠ¤íŠ¸
ë² ì´ì§€ì•ˆ A/B/C/D ê²€ì¦ì€ ì•„ë˜ì˜ ìˆ˜ì‹ì„ ë”°ë¼ ì§„í–‰ ë©ë‹ˆë‹¤. ìì„¸í•œ ì¦ëª…ì€ [8]ì„ ì°¸ì¡°í•˜ì‹œë©´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![abcd](./images/abcd.png)

```     
>>> # ë² ì´ì§€ì•ˆ A/B/C/D í…ŒìŠ¤íŠ¸ ì‚¬ìš© ì˜ˆì‹œ
>>> online_abtesting = ConversionEstimater(control = bucket_a
>>>                                        , target = bucket_b_example
>>>                                        , control_reward_col = 'reward'
>>>                                        , target_reward_col = 'reward'
>>>                                        , control2 = bucket_c
>>>                                        , control3 = bucket_d)
>>> control_click_rate, control2_click_rate, control3_click_rate, target_click_rate, prob_b_a = online_abtesting.cal_multi_bayes_prob()
>>> print("Control 1 Grp Click rate : ", control_click_rate)
>>> print("Control 2 Grp Click rate : ", control2_click_rate)
>>> print("Control 3 Grp Click rate : ", control3_click_rate)
>>> print("Target Grp Click rate : ", target_click_rate)
>>> print("probability Pt > Pc : ", prob_t_c)
>>> print("ì§€ìˆ˜í˜• -> ìˆ«ìí˜• : ", '{:.8f}'.format(prob_t_c))
Control 1 Grp Click rate :  0.01483019427554501
Control 2 Grp Click rate :  0.02323984298374124
Control 3 Grp Click rate :  0.01231827391872837
Target Grp Click rate :  0.0015598692680994354
probability Pt > Pc :  3.7421643192430597e-113
ì§€ìˆ˜í˜• -> ìˆ«ìí˜• :  0.00000000
```  
   
ë°˜í™˜ë˜ëŠ” ê²°ê³¼ëŠ” ëŒ€ì¡°êµ° 1 ì „í™˜ìœ¨, ëŒ€ì¡°êµ° 2 ì „í™˜ìœ¨, ëŒ€ì¡°êµ° 3 ì „í™˜ìœ¨, íƒ€ê²Ÿêµ° ì „í™˜ìœ¨, íƒ€ê²Ÿêµ°ì´ ëŒ€ì¡°êµ° ëŒ€ë¹„ ë” ë§ì´ ì „í™˜ë  í™•ë¥ ì…ë‹ˆë‹¤. ë² ì´ì§€ì•ˆ A/B/C í…ŒìŠ¤íŠ¸ì™€ ë™ì¼í•˜ê²Œ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  
### ë­í‚¹ ê¸°ë°˜ ì¶”ì²œ ì„±ëŠ¥ 

ë­í‚¹ ê¸°ë°˜ ì¶”ì²œ ì„±ëŠ¥ì€ MAP(Mean Average Precision), MAR(Mean Average Recall), nDCG(Normailzed Discounted Cumulative Gain)ê°€ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì— ìœ ì˜í•  ì ì€ ì €í¬ëŠ” ë¡œê·¸ë¥¼ DBë¡œë¶€í„° pandas í˜•íƒœë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì— ìµìˆ™í•˜ì—¬ ì´ë¥¼ ê·¸ëŒ€ë¡œ ë„£ì„ ìˆ˜ ìˆë„ë¡ ê°œë°œì´ ë˜ì—ˆëŠ”ë° MAPë‚˜ MAR, nDCG ë“±ì„ ê³„ì‚°í•  ë•Œ ì¶”ì²œì˜ ìˆœì„œ ë³„ë¡œ ì •ë ¬í•˜ì—¬ ë„£ì–´ì•¼ í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ë³„ë„ë¡œ ì •ë ¬ ë¡œì§ì„ ì¶”ê°€í•˜ë ¤ê³  í•˜ë‹¤ê°€ ì¶”ì²œì„ ë‹´ë‹¹í•˜ëŠ” ë‹´ë‹¹ìê°€ ì¶”ì²œì˜ ìˆœì„œë¥¼ ì˜ ì•Œí…Œë‹ˆ ê³¼ì œë§ˆë‹¤ ë‹¤ë¥¸ ê²½ìš°ë¥¼ ê³ ë ¤í•˜ì§€ ì•Šê³  ì •ë ¬ ë¡œì§ì„ ì‹¬ëŠ” ê²ƒ ë³´ë‹¤ ì¶”ì²œì˜ ë‚´ìš©ê³¼ ë°ì´í„°ë¥¼ ì˜ ì•„ëŠ” ë‹´ë‹¹ìê°€ ì •ë ¬í•´ì„œ ë°ì´í„°ë¥¼ ë„£ì–´ ì—°ì‚°í•  ìˆ˜ ìˆë„ë¡ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ ì € ë³„ë¡œ ê°€ì¥ ì²« ë²ˆì§¸ë¡œ ì¶”ì²œë˜ëŠ” ì•„ì´í…œì„ ì²˜ìŒìœ¼ë¡œ ë“±ì¥í•˜ë„ë¡ ì •ë ¬í•œ ë’¤ì— í•¨ìˆ˜ì— ë„£ìœ¼ë©´ ê·¸ ìˆœì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ë±ì‹±ì„ ìˆ˜í–‰í•˜ë¯€ë¡œ ì •ë ¬ì„ í•˜ì§€ ì•Šìœ¼ë©´ ì œëŒ€ë¡œ ëœ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### MAP
ì¶”ì²œ ì‹œìŠ¤í…œì—ì„œëŠ” ì‚¬ìš©ìê°€ ê´€ì‹¬ì„ ë” ë§ì´ ê°€ì§ˆë§Œí•œ ì•„ì´í…œì„ ìƒìœ„ì— ì¶”ì²œí•´ì£¼ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì„±ëŠ¥ í‰ê°€ì— ìˆœì„œ ê°œë…ì„ ë„ì…í•œ ê²ƒì´ Mean Average Precision @ K ì…ë‹ˆë‹¤. ê³„ì‚°ì€ ì•„ë˜ì˜ ê·¸ë¦¼ì„ ë³´ì‹œë©´ ì´í•´í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![map](./images/map.png)

```     
>>> # MAP(Mean Average Precision) ì‚¬ìš© ì˜ˆì‹œ
>>> online_abtesting = RankingEstimater(rec = bucket_a
>>>                                     , item_col = 'prod_id'
>>>                                     , user_col = 'ci'
>>>                                     , reward = 'click_yn'
>>>                                     , k = 3)        
>>> map_cal = online_abtesting.mean_average_precision()
>>> print("Mean Average Precision : ", map_cal)
Mean Average Precision : 0.5
```  

#### MAR
MAP ê°€ Precisionì— ê¸°ë°˜í•´ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ MARì€ Recallì— ê¸°ë°˜í•˜ì—¬ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. MAPê³„ì‚°ì—ì„œ Precision ëŒ€ì‹ ì— Recallì„ ëŒ€ì…í•˜ì—¬ ê³„ì‚°í•˜ê²Œ ë©ë‹ˆë‹¤.

```     
>>> # MAR(Mean Average Recall) ì‚¬ìš© ì˜ˆì‹œ
>>> online_abtesting = RankingEstimater(rec = bucket_a
>>>                                     , item_col = 'prod_id'
>>>                                     , user_col = 'ci'
>>>                                     , reward = 'click_yn'
>>>                                     , k = 3
>>>                                     , reco_col = 'impression_yn')        
>>> mar_cal = online_abtesting.mean_average_recall()
>>> print("Mean Average Recall : ", mar_cal)
Mean Average Recall : 0.5
```  

#### nDCG
nDCGëŠ” ì›ë˜ ê²€ìƒ‰ ë¶„ì•¼ì—ì„œ ë“±ì¥í•œ ì§€í‘œì´ë‚˜ ì¶”ì²œ ì‹œìŠ¤í…œì—ë„ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤. Top Kê°œ ì•„ì´í…œì„ ì¶”ì²œí•˜ëŠ” ê²½ìš°, ì¶”ì²œ ìˆœì„œì— ê°€ì¤‘ì¹˜ë¥¼ ë‘ì–´ í‰ê°€í•©ë‹ˆë‹¤. NDCG @ Kê°’ì€ 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì´ëŠ” ê²ƒì´ë©°. ìˆœì„œë³„ë¡œ ê°€ì¤‘ì¹˜ ê°’(ê´€ë ¨ë„, relevance)ì„ ë‹¤ë¥´ê²Œ ì ìš©í•˜ì—¬ ê³„ì‚°í•©ë‹ˆë‹¤. ê³„ì‚°ì€ ì•„ë˜ì˜ ê·¸ë¦¼ì„ ë³´ì‹œë©´ ì´í•´í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ndcg](./images/ndcg.png)

```     
>>> # MAP(Mean Average Precision) ì‚¬ìš© ì˜ˆì‹œ
>>> online_abtesting = RankingEstimater(rec = bucket_a
>>>                                     , item_col = 'prod_id'
>>>                                     , user_col = 'ci'
>>>                                     , reward = 'click_yn'
>>>                                     , k = 3)        
>>> ndcg = online_abtesting.ndcg()
>>> print("Normailzed Discounted Cumulative Gain : ", ndcg)
Normailzed Discounted Cumulative Gain : 0.5
```  

### ì—°ì† ê°’ ì°¨ì´ ì¶”ì •
battlegroundì—ëŠ” Binary Conversion ì„±ëŠ¥ ì¶”ì •ì— ë§ì¶”ì–´ ê°œë°œì´ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ìœ ëŠ” í˜„ì¬ T3Kì˜ KPIëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ì—°ê´€ë˜ì–´ CTR í–¥ìƒì„ í•´ì•¼í•˜ëŠ” ìƒí™©ì´ê³ , CTRì€ ì„¸ë¶€ì ìœ¼ë¡œ ë³´ë©´ í´ë¦­ í•œë‹¤/ì•ˆí•œë‹¤ì˜ actionì´ 2ê°œì´ê¸° ë•Œë¬¸ì— Binary Conversion ì„±ëŠ¥ ì¶”ì •ì´ í•„ìš”í•œ ìƒí™©ì´ê³  í˜„ì¬ ì‹œì ì—ì„œ ì•„ë¬´ëŸ° ê²ƒë„ ê°œë°œì´ ì•ˆë˜ì–´ìˆê¸° ë•Œë¬¸ì— ìš°ì„ ìˆœìœ„ë¥¼ ë§ì¶”ì–´ Binary Conversion ì„±ëŠ¥ ì¶”ì •ì— ì´ˆì ì„ ë§ì¶”ì–´ ê°œë°œí•˜ì˜€ìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ A/B í…ŒìŠ¤íŠ¸ëŠ” Binary Conversion ì™¸ì—ë„ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì§„í–‰ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í˜ì´ì§€ì— ë¨¸ë¬¸ ì‹œê°„, í˜ì´ì§€ì— ì–´ëŠ ìœ„ì¹˜ê¹Œì§€ ë³´ì•˜ëŠ”ì§€, ì´ ë§¤ì¶œ ë“± ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ ì§„í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì—°ì†ì ì¸ ê°’(Continuous)ë„ ì„±ëŠ¥ì„ ì¶”ì •í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•˜ì—¬ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. 

#### ë…ë¦½ í‘œë³¸ T ê²€ì¦
A/B í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë…ë¦½ì ì¸ ë‘ ëª¨ì§‘ë‹¨ì—ì„œ ì¶”ì¶œëœ ìƒ˜í”Œ ê°„ ë¹„êµë¥¼ ìœ„í•´ ë…ë¦½ í‘œë³¸ Tê²€ì¦ì„ ì¤€ë¹„í•´ë‘ì—ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [7]ì„ ì°¸ì¡°í•˜ì‹œë©´ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš© ì˜ˆì‹œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```  
>>> control = stats.norm.rvs(loc=5, scale=10, size=500, random_state=1)
>>> target = stats.norm.rvs(loc=5, scale=10, size=500, random_state=1)
>>> ttest = ContinuousCompare(control = control
>>>                           , target = target)        
>>> t_stat, p_val, effect_size = ttest.ttest()
>>> if p_val < 0.05 :
>>>     print("ì§‘ë‹¨ ë³„ í‰ê· ì´ ê°™ì§€ ì•Šë‹¤ê³  ì£¼ì¥í•  ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì§€ ëª»í•˜ì˜€ë‹¤.")
>>> else:
>>>     print("ì§‘ë‹¨ ë³„ í‰ê· ì´ ê°™ì§€ ì•Šë‹¤ê³  ì£¼ì¥í•  ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì—ˆë‹¤.")
ì§‘ë‹¨ ë³„ í‰ê· ì´ ê°™ì§€ ì•Šë‹¤ê³  ì£¼ì¥í•  ì¶©ë¶„í•œ ê·¼ê±°ë¥¼ ì–»ì—ˆë‹¤.
```  

ë°˜í™˜ë˜ëŠ” ê²°ê³¼ëŠ” í¬ê²Œ ì„¸ê°€ì§€ë¡œ tí†µê³„ëŸ‰, p value, íš¨ê³¼í¬ê¸°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë‘ ì§‘ë‹¨ ê°„ í‘œë³¸ í‰ê· ìœ¼ë¡œ ì¶”ì •í•œ ëª¨ì§‘ë‹¨ì˜ í‰ê· ì´ ì°¨ì´ê°€ ìˆëŠ”ì§€, ìˆë‹¤ë©´ ì–´ëŠì •ë„ ì°¨ì´ë¡œ ì°¨ì´ê°€ ìˆëŠ”ì§€ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ë² ì´ì§€ì•ˆ T ê²€ì¦
ë² ì´ì§€ì•ˆ T ê²€ì¦ì€ [8]ì— ê¸°ë°˜í•˜ì—¬ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [8]ì„ ì°¸ì¡°í•˜ì‹œë©´ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ì‚¬ìš© ì˜ˆì‹œì…ë‹ˆë‹¤.

```  
>>> control = stats.norm.rvs(loc=5, scale=10, size=500, random_state=1)
>>> target = stats.norm.rvs(loc=5, scale=10, size=500, random_state=1)
>>> diff_val = 0.01
>>> ttest = ContinuousCompare(control = control
>>>                           , target = target
>>>                           , diff = diff_val)        
>>> prob = ttest.bayes_ttest()
>>> print(f"target ê·¸ë£¹ì˜ í‰ê· ì´ control ê·¸ë£¹ì˜ í‰ê· ë³´ë‹¤ {diff_val} ë§Œí¼ í´ í™•ë¥  : ", prob)
target ê·¸ë£¹ì˜ í‰ê· ì´ control ê·¸ë£¹ì˜ í‰ê· ë³´ë‹¤ 0.01 ë§Œí¼ í´ í™•ë¥  : 0.6
```  

-------------------
[1] https://statistics.stanford.edu/technical-reports/determining-appropriate-sample-size-confidence-limits-proportion

[2] https://www.evanmiller.org/ab-testing/sample-size-fixed.js

[3] https://www.evanmiller.org/ab-testing/sample-size.html

[4] https://en.wikipedia.org/wiki/Chi-squared_test

[5] https://www.evanmiller.org/bayesian-ab-testing.html#count_ab

[6] https://vitalflux.com/two-sample-z-test-for-proportions-formula-examples/

[7] https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_ind.html

[8] https://best.readthedocs.io/en/latest/index.html
